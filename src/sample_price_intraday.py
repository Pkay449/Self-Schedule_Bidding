import numpy as np
from scipy.io import loadmat

def sample_price_intraday(Pt_day, Pt_intraday, t, Season):
    """
    Compute the expected values (mu_P) and covariance matrix (cov_P) of intraday prices
    given current observed day-ahead and intraday prices and the current stage.

    Parameters
    ----------
    Pt_day : np.ndarray
        Current observed day-ahead prices as a 1D array (row vector).
    Pt_intraday : np.ndarray
        Current observed intraday prices as a 1D array (row vector).
    t : int
        Current time stage (1-based index as in MATLAB).
    Season : str
        The season name (e.g., 'Summer').

    Returns
    -------
    mu_P : np.ndarray
        The expected values of intraday prices as a 1D array.
    cov_P : np.ndarray
        The covariance matrix of intraday prices.
    """

    # Load required data
    beta_day_ahead_data = loadmat(f'Data/beta_day_ahead_{Season}.mat')
    cov_day_data = loadmat(f'Data/cov_day_{Season}.mat')
    beta_intraday_data = loadmat(f'Data/beta_intraday_{Season}.mat')
    cov_intraday_data = loadmat(f'Data/cov_intraday_{Season}.mat')
    DoW_data = loadmat(f'Data/DoW_{Season}.mat')

    # Extract variables
    beta_day_ahead = beta_day_ahead_data['beta_day_ahead']
    cov_day = cov_day_data['cov_day']
    beta_intraday = beta_intraday_data['beta_intraday']
    cov_intraday = cov_intraday_data['cov_intraday']

    # We assume DoW_P0 is in DoW_data with variable name 'DoW_P0'
    DoW_P0 = DoW_data['DoW_P0'].item()

    # Construct DOW vector
    DOW = np.zeros(7)
    dow_index = int((t + DoW_P0 - 1) % 7)
    DOW[dow_index] = 1

    # Q = [1, DOW, Pt_intraday, Pt_day]
    Q = np.concatenate(([1], DOW, Pt_intraday, Pt_day))

    # mu_P = Q * beta_intraday'
    mu_P = Q @ beta_intraday.T

    # cov_P = cov_intraday
    cov_P = cov_intraday

    return mu_P, cov_P

# # Example usage (if data is prepared):
# Pt_day = [37.98, 37.54, 35.98, 35.78, 36.19, 38.0, 44.12, 61.11, 61.94, 59.78, 51.47, 50.71,
#           47.7, 45.83, 44.01, 43.17, 43.21, 47.9, 52.02, 55.93, 65.71, 69.95, 54.51, 42.62,
#           38.8, 38.35, 38.16, 38.0, 38.16, 39.54, 48.5, 54.98, 56.16, 54.25, 49.9, 45.96,
#           41.75, 40.65, 40.0, 39.95, 39.78, 42.04, 46.91, 53.66, 52.99, 47.88, 43.66, 38.66,
#           35.77, 34.05, 32.65, 32.46, 32.7, 35.43, 40.75, 51.95, 57.4, 51.51, 48.84, 48.29,
#           47.35, 45.72, 45.3, 45.13, 44.95, 45.21, 49.5, 60.74, 60.5, 53.23, 49.38, 43.25,
#           30.98, 30.02, 28.2, 26.27, 27.1, 26.8, 25.6, 28.1, 30.05, 30.28, 32.06, 32.61,
#           31.68, 29.32, 28.45, 28.45, 30.05, 34.0, 38.37, 40.03, 40.3, 40.87, 41.46, 39.01,
#           39.01, 37.59, 37.01, 36.04, 35.1, 35.28, 34.2, 36.05, 37.42, 39.43, 38.16, 36.89,
#           34.9, 33.71, 32.92, 32.74, 33.85, 35.62, 38.79, 38.94, 37.91, 36.19, 36.19, 34.0,
#           38.65, 37.73, 37.19, 36.57, 36.37, 38.49, 43.08, 49.66, 54.18, 55.89, 53.66, 48.31,
#           39.6, 39.03, 38.72, 38.85, 39.36, 49.19, 52.07, 53.62, 52.06, 48.97, 48.14, 38.67,
#           45.62, 42.05, 39.58, 39.09, 38.9, 40.67, 47.07, 58.94, 55.31, 56.7, 52.78, 50.65,
#           47.85, 46.94, 45.69, 47.78, 50.15, 56.85, 62.05, 69.58, 61.86, 56.75, 50.74, 41.88]
# # Pt_day = [38.53195609,31.06848089,26.8140244,24.44210487,21.70834517,20.62375654,21.68734072,32.85539149,42.05427771,42.67762207,40.75950933,36.06892216,30.06504392,21.14890524,25.01759529,29.67146471,33.77883191,42.30273396,48.14441493,58.89940433,56.20593145,42.68751175,40.71838468,31.45173641,32.87977924,32.23490506,31.68981755,31.2634084,29.55198696,28.88556957,40.0223688,49.08036604,52.84958902,41.40495421,42.09616319,43.35830545,41.28950987,46.46354403,46.84067647,44.8298404,51.25300245,55.68762625,56.41171017,57.34373612,55.37833947,43.90607661,43.05153679,42.98255348,53.82254135,47.81763934,50.11681157,47.01774448,42.3325405,43.92811311,50.57026212,58.04368407,61.80389208,66.3385177,62.3259137,53.24012968,52.86924855,48.54304427,52.09560704,46.20198542,50.95479805,53.57705501,52.75128542,55.35727847,56.43253596,48.91775648,43.8690209,37.92906206,37.98,37.54,35.98,35.78,36.19,38.,44.12,61.11,61.94,59.78,51.47,50.71,47.7,45.83,44.01,43.17,43.21,47.9,52.02,55.93,65.71,69.95,54.51,42.62,38.8,38.35,38.16,38.,38.16,39.54,48.5,54.98,56.16,54.25,49.9,45.96,41.75,40.65,40.,39.95,39.78,42.04,46.91,53.66,52.99,47.88,43.66,38.66,35.77,34.05,32.65,32.46,32.7,35.43,40.75,51.95,57.4,51.51,48.84,48.29,47.35,45.72,45.3,45.13,44.95,45.21,49.5,60.74,60.5,53.23,49.38,43.25,30.98,30.02,28.2,26.27,27.1,26.8,25.6,28.1,30.05,30.28,32.06,32.61,31.68,29.32,28.45,28.45,30.05,34.,38.37,40.03,40.3,40.87,41.46,39.01,39.01,37.59,37.01,36.04,35.1,35.28,34.2,36.05,37.42,39.43,38.16,36.89,34.9,33.71,32.92,32.74,33.85,35.62,38.79,38.94,37.91,36.19,36.19,34.]
# Pt_intraday = [40.97,33.34,32.56,23.63,47.1,35.54,32.52,30.12,37.58,31.47,32.14,31.59
# ,35.15,32.34,32.07,30.17,25.93,30.12,35.55,42.98,20.79,28.44,39.51,64.42
# ,20.73,35.8,63.86,85.01,40.98,56.89,64.41,64.45,72.9,65.78,54.35,41.39
# ,73.29,63.25,43.86,37.11,64.46,50.13,40.07,34.93,63.54,53.34,43.61,40.02
# ,58.88,43.78,40.01,33.9,64.41,51.62,38.71,26.14,37.33,40.04,43.49,45.72
# ,36.64,37.35,41.22,44.26,28.03,32.56,43.82,56.45,29.73,35.2,57.54,84.58
# ,30.18,39.95,59.96,94.96,40.96,49.02,60.92,79.42,81.42,64.57,60.19,55.22
# ,78.84,67.53,64.58,60.06,83.33,64.4,40.48,26.73,76.98,50.08,32.69,30.01
# ,43.39,40.61,38.87,34.86,41.27,38.48,41.86,38.49,39.58,38.25,38.26,42.03
# ,38.06,38.06,38.06,38.09,33.63,36.13,38.29,44.32,32.53,35.13,39.52,50.44
# ,36.66,41.81,57.52,57.46,49.37,56.29,58.66,57.03,64.79,61.85,51.12,45.47
# ,64.75,56.79,49.57,44.87,60.82,51.06,42.15,39.55,55.3,47.97,41.84,36.76
# ,51.7,42.75,35.28,32.62,49.94,46.95,34.91,31.34,36.74,36.08,38.01,38.65
# ,33.89,34.48,38.99,43.33,29.81,32.43,44.08,50.39,27.41,33.04,49.06,57.02
# ,33.59,39.47,52.75,63.37,45.74,50.61,58.45,63.6,63.89,53.92,50.02,47.78
# ,56.76,50.85,47.66,44.02,59.74,50.75,42.24,32.95,53.,49.55,42.56,32.5
# ,42.5,35.9,34.6,30.14,34.57,34.18,34.19,33.34,32.73,31.83,32.75,32.77
# ,32.53,30.82,32.57,31.4,30.02,29.6,33.02,36.75,28.43,30.49,35.44,43.38
# ,28.03,34.97,49.92,58.96,42.08,48.59,57.33,64.75,58.53,57.75,54.07,51.09
# ,59.13,51.34,50.26,44.68,57.37,52.7,46.5,42.56,56.42,51.37,46.59,44.79
# ,53.99,49.53,45.56,43.08,54.35,49.82,40.53,38.75,42.74,41.43,43.03,43.91
# ,43.31,42.96,44.4,46.23,37.99,40.1,47.04,51.73,35.34,45.34,49.54,55.93
# ,41.05,44.92,53.4,60.71,53.3,57.23,58.01,64.71,73.32,60.11,52.91,52.35
# ,59.74,55.81,50.06,44.95,62.37,48.61,48.14,39.79,53.22,45.45,39.85,32.59
# ,34.86,32.18,30.24,27.72,32.17,30.07,28.85,28.04,28.96,28.,30.11,29.84
# ,26.72,25.37,28.19,27.98,27.68,23.46,30.1,32.31,28.42,22.98,28.17,21.8
# ,23.36,22.89,29.51,30.68,24.86,26.1,30.55,32.35,30.35,30.75,28.58,31.61
# ,31.5,26.59,29.09,26.37,34.56,34.25,32.02,28.01,40.03,35.11,32.45,28.28
# ,32.71,30.09,32.35,27.78,32.57,27.87,24.3,23.12,27.4,27.11,26.77,28.74
# ,23.27,23.85,28.11,30.89,20.69,24.2,30.02,35.59,20.09,27.79,37.75,42.05
# ,32.77,36.92,41.11,43.07,38.37,40.19,40.27,42.15,40.12,41.06,40.37,36.9
# ,40.23,40.01,40.33,40.77,48.98,41.13,40.49,31.08,45.64,40.81,34.07,28.61
# ,48.9,43.29,38.62,36.5,39.9,42.18,39.58,36.01,34.29,36.21,42.04,42.46
# ,36.92,36.85,36.9,36.86,37.3,37.3,35.29,36.24,42.4,37.45,32.43,33.5
# ,34.09,35.18,38.72,38.68,35.4,35.37,39.67,39.35,42.51,41.41,43.16,35.52
# ,47.73,42.13,41.89,31.68,47.95,40.13,36.39,29.22,37.8,35.28,38.42,28.27
# ,41.98,38.42,30.77,24.98,34.44,30.05,30.83,29.21,29.03,29.03,29.59,34.9
# ,21.28,26.57,30.77,36.99,20.88,31.95,36.58,43.1,21.,35.41,38.31,49.9
# ,28.26,37.7,40.07,49.95,36.04,40.07,40.07,43.18,38.94,38.07,38.19,37.02
# ,41.84,40.12,36.95,34.11,45.92,40.21,38.8,30.01,42.48,38.35,34.93,25.07
# ,45.8,42.04,38.79,37.9,39.77,37.79,40.99,37.74,37.28,37.25,40.6,43.12
# ,37.49,36.69,37.52,40.02,33.02,36.44,43.73,46.84,32.57,37.35,41.88,44.29
# ,31.18,42.17,53.13,55.91,49.7,51.83,51.84,50.25,65.49,57.86,53.25,42.96
# ,76.29,61.02,50.76,39.1,77.86,59.38,46.4,38.02,58.98,53.16,43.29,38.04
# ,48.65,44.82,41.11,35.35,51.84,46.01,37.35,31.58,33.18,38.06,44.71,46.69
# ,33.98,38.2,45.32,47.35,29.46,38.71,47.96,52.61,31.29,45.33,57.76,65.79
# ,38.09,49.02,58.04,69.98,52.99,58.66,59.99,65.16,65.13,53.17,50.93,49.18
# ,56.89,53.17,48.03,42.05,69.99,54.05,45.84,36.45,54.6,47.95,35.22,29.73
# ,51.16,48.2,44.54,42.85,45.15,47.34,44.57,42.4,43.04,39.72,44.08,47.52
# ,38.22,41.05,42.87,46.12,32.06,36.59,45.28,50.99,31.29,38.78,44.96,51.76
# ,34.42,48.15,57.48,65.32,60.7,65.98,59.08,57.78,81.03,63.33,51.86,38.01
# ,76.89,63.82,51.87,41.06,73.53,59.16,51.65,41.4,61.24,52.85,46.,38.04
# ,57.36,50.9,43.23,42.07,54.66,52.07,44.74,38.07,42.71,46.16,50.7,51.79
# ,39.86,47.03,51.71,54.82,39.3,47.67,53.54,62.74,36.72,53.99,64.37,84.8
# ,46.42,56.64,68.54,90.,63.1,71.72,75.39,79.17,85.4,68.64,59.51,51.83
# ,75.17,61.4,53.95,47.06,74.75,55.73,48.21,36.94,54.98,48.6,39.77,31.14]
# # Pt_intraday = [20.91554969,26.41741081,28.07537254,32.25478068,29.25709296,31.42480863,29.1067746,26.82929371,28.30590441,30.33544022,32.75536447,30.1900506,23.79391372,28.57929474,24.03705709,25.31086229,22.43223559,26.36834713,26.07520636,26.17634042,25.61131373,26.78115913,29.64759905,34.15671019,29.04313648,42.5658612,41.9915568,38.60521283,47.16461952,48.87928473,47.13467777,46.33727129,64.17656915,54.16752871,45.09235348,39.10253312,50.23683784,42.62142321,43.12360711,46.73005769,45.33794166,39.7441227,40.59186584,44.84565615,43.29606408,40.84459358,44.05118721,44.78498805,41.23140837,39.83891915,38.89577333,43.15718028,41.23937028,46.02802552,43.14918006,42.1304456,44.73318963,49.2539144,48.40241963,50.80904147,44.28503455,46.54092278,49.7045736,54.59638775,35.04684168,41.40254636,52.54280025,58.39584637,41.94603643,42.58441714,58.1465687,57.25467552,46.66014422,50.71696369,58.23849805,64.54331063,48.29265349,50.15987477,59.94655228,61.80060285,52.78259413,51.11726421,49.94181268,51.11861214,53.30770309,45.7940777,40.56867147,39.52829633,54.13175067,44.70352025,41.0154884,35.69430566,41.83172953,35.56763517,40.611079,39.3025646,56.13553503,47.66004445,46.53865506,40.05881455,50.93054451,44.92119189,48.23414752,46.36764952,41.00112189,42.03992084,44.77506079,41.53922141,38.56989432,39.2995694,41.83114637,43.7199213,33.27010648,37.92737498,39.71727449,42.63621428,34.78288531,43.24705846,46.42121571,48.84686175,34.83730656,46.35940822,49.95823597,56.76023845,55.89156984,57.93274199,65.20401033,63.77996917,72.03007865,65.06422527,60.53501912,52.41357603,65.63402578,59.0693867,60.63050076,48.61078727,66.37749279,60.85409873,54.96911041,42.99988506,62.27798732,57.1608991,55.59876525,46.37160741,51.95450648,45.4954696,54.3144412,57.870079,50.30310291,52.26688925,51.27921469,48.73088089,44.39688426,49.18241375,50.39093734,49.82724052,50.1388359,49.13514244,48.62589529,55.68205875,46.96705215,50.82701677,57.06535581,62.40337695,43.72898758,51.08880766,54.56472324,54.64858751,43.26202162,50.9076008,55.89874224,66.32409346,53.15298927,56.94440141,58.43119058,62.36520962,59.53832787,57.88550982,54.17519755,52.20513496,60.20076674,57.6690962,51.53492963,46.07989205,63.14801177,53.18498279,46.98083413,31.8161732,48.2943149,43.91794899,47.2420485,35.5507859,40.97,33.34,32.56,23.63,47.1,35.54,32.52,30.12,37.58,31.47,32.14,31.59,35.15,32.34,32.07,30.17,25.93,30.12,35.55,42.98,20.79,28.44,39.51,64.42,20.73,35.8,63.86,85.01,40.98,56.89,64.41,64.45,72.9,65.78,54.35,41.39,73.29,63.25,43.86,37.11,64.46,50.13,40.07,34.93,63.54,53.34,43.61,40.02,58.88,43.78,40.01,33.9,64.41,51.62,38.71,26.14,37.33,40.04,43.49,45.72,36.64,37.35,41.22,44.26,28.03,32.56,43.82,56.45,29.73,35.2,57.54,84.58,30.18,39.95,59.96,94.96,40.96,49.02,60.92,79.42,81.42,64.57,60.19,55.22,78.84,67.53,64.58,60.06,83.33,64.4,40.48,26.73,76.98,50.08,32.69,30.01,43.39,40.61,38.87,34.86,41.27,38.48,41.86,38.49,39.58,38.25,38.26,42.03,38.06,38.06,38.06,38.09,33.63,36.13,38.29,44.32,32.53,35.13,39.52,50.44,36.66,41.81,57.52,57.46,49.37,56.29,58.66,57.03,64.79,61.85,51.12,45.47,64.75,56.79,49.57,44.87,60.82,51.06,42.15,39.55,55.3,47.97,41.84,36.76,51.7,42.75,35.28,32.62,49.94,46.95,34.91,31.34,36.74,36.08,38.01,38.65,33.89,34.48,38.99,43.33,29.81,32.43,44.08,50.39,27.41,33.04,49.06,57.02,33.59,39.47,52.75,63.37,45.74,50.61,58.45,63.6,63.89,53.92,50.02,47.78,56.76,50.85,47.66,44.02,59.74,50.75,42.24,32.95,53.,49.55,42.56,32.5,42.5,35.9,34.6,30.14,34.57,34.18,34.19,33.34,32.73,31.83,32.75,32.77,32.53,30.82,32.57,31.4,30.02,29.6,33.02,36.75,28.43,30.49,35.44,43.38,28.03,34.97,49.92,58.96,42.08,48.59,57.33,64.75,58.53,57.75,54.07,51.09,59.13,51.34,50.26,44.68,57.37,52.7,46.5,42.56,56.42,51.37,46.59,44.79,53.99,49.53,45.56,43.08,54.35,49.82,40.53,38.75,42.74,41.43,43.03,43.91,43.31,42.96,44.4,46.23,37.99,40.1,47.04,51.73,35.34,45.34,49.54,55.93,41.05,44.92,53.4,60.71,53.3,57.23,58.01,64.71,73.32,60.11,52.91,52.35,59.74,55.81,50.06,44.95,62.37,48.61,48.14,39.79,53.22,45.45,39.85,32.59,34.86,32.18,30.24,27.72,32.17,30.07,28.85,28.04,28.96,28.,30.11,29.84,26.72,25.37,28.19,27.98,27.68,23.46,30.1,32.31,28.42,22.98,28.17,21.8,23.36,22.89,29.51,30.68,24.86,26.1,30.55,32.35,30.35,30.75,28.58,31.61,31.5,26.59,29.09,26.37,34.56,34.25,32.02,28.01,40.03,35.11,32.45,28.28,32.71,30.09,32.35,27.78,32.57,27.87,24.3,23.12,27.4,27.11,26.77,28.74,23.27,23.85,28.11,30.89,20.69,24.2,30.02,35.59,20.09,27.79,37.75,42.05,32.77,36.92,41.11,43.07,38.37,40.19,40.27,42.15,40.12,41.06,40.37,36.9,40.23,40.01,40.33,40.77,48.98,41.13,40.49,31.08,45.64,40.81,34.07,28.61,48.9,43.29,38.62,36.5,39.9,42.18,39.58,36.01,34.29,36.21,42.04,42.46,36.92,36.85,36.9,36.86,37.3,37.3,35.29,36.24,42.4,37.45,32.43,33.5,34.09,35.18,38.72,38.68,35.4,35.37,39.67,39.35,42.51,41.41,43.16,35.52,47.73,42.13,41.89,31.68,47.95,40.13,36.39,29.22,37.8,35.28,38.42,28.27,41.98,38.42,30.77,24.98,34.44,30.05,30.83,29.21,29.03,29.03,29.59,34.9,21.28,26.57,30.77,36.99,20.88,31.95,36.58,43.1,21.,35.41,38.31,49.9,28.26,37.7,40.07,49.95,36.04,40.07,40.07,43.18,38.94,38.07,38.19,37.02,41.84,40.12,36.95,34.11,45.92,40.21,38.8,30.01,42.48,38.35,34.93,25.07]

# mu_P, cov_P = sample_price_intraday(Pt_day, Pt_intraday, t=2, Season='Summer')
